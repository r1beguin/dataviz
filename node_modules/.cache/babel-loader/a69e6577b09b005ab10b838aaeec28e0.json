{"ast":null,"code":"function _extends() {\n  _extends = Object.assign || function (target) {\n    for (var i = 1; i < arguments.length; i++) {\n      var source = arguments[i];\n\n      for (var key in source) {\n        if (Object.prototype.hasOwnProperty.call(source, key)) {\n          target[key] = source[key];\n        }\n      }\n    }\n\n    return target;\n  };\n\n  return _extends.apply(this, arguments);\n}\n\nfunction _objectWithoutPropertiesLoose(source, excluded) {\n  if (source == null) return {};\n  var target = {};\n  var sourceKeys = Object.keys(source);\n  var key, i;\n\n  for (i = 0; i < sourceKeys.length; i++) {\n    key = sourceKeys[i];\n    if (excluded.indexOf(key) >= 0) continue;\n    target[key] = source[key];\n  }\n\n  return target;\n}\n\nimport React, { forwardRef, useCallback, useContext, useEffect, useRef, useState } from 'react';\nimport { ThemeContext } from 'styled-components';\nimport { defaultProps } from '../../default-props';\nimport { Box } from '../Box';\nimport { Button } from '../Button';\nimport { Drop } from '../Drop';\nimport { FormContext } from '../Form/FormContext';\nimport { Keyboard } from '../Keyboard';\nimport { useForwardedRef } from '../../utils';\nimport { StyledMaskedInput, StyledMaskedInputContainer, StyledIcon } from './StyledMaskedInput';\n\nvar parseValue = function parseValue(mask, value) {\n  // break the value up into mask parts\n  var valueParts = []; // { part, beginIndex, endIndex }\n\n  var valueIndex = 0;\n  var maskIndex = 0;\n\n  while (value !== undefined && valueIndex < value.length && maskIndex < mask.length) {\n    var item = mask[maskIndex];\n    var found = void 0;\n\n    if (item.fixed) {\n      var length = item.fixed.length; // grab however much of value (starting at valueIndex) matches\n      // item.fixed. If none matches it and there is more in value\n      // add in the fixed item.\n\n      var matching = 0;\n\n      while (matching < length && value[valueIndex + matching] === item.fixed[matching]) {\n        matching += 1;\n      }\n\n      if (matching > 0) {\n        var part = value.slice(valueIndex, valueIndex + matching);\n\n        if (valueIndex + matching < value.length) {\n          // matched part of the fixed portion but there's more stuff\n          // after it. Go ahead and fill in the entire fixed chunk\n          part = item.fixed;\n        }\n\n        valueParts.push({\n          part: part,\n          beginIndex: valueIndex,\n          endIndex: valueIndex + matching - 1\n        });\n        valueIndex += matching;\n      } else {\n        valueParts.push({\n          part: item.fixed,\n          beginIndex: valueIndex,\n          endIndex: valueIndex + length - 1\n        });\n      }\n\n      maskIndex += 1;\n      found = true;\n    } else if (item.options) {\n      // reverse assuming larger is later\n      found = item.options.slice(0).reverse() // eslint-disable-next-line no-loop-func\n      .some(function (option) {\n        var length = option.length;\n        var part = value.slice(valueIndex, valueIndex + length);\n\n        if (part === option) {\n          valueParts.push({\n            part: part,\n            beginIndex: valueIndex,\n            endIndex: valueIndex + length - 1\n          });\n          valueIndex += length;\n          maskIndex += 1;\n          return true;\n        }\n\n        return false;\n      });\n    }\n\n    if (!found) {\n      if (item.regexp) {\n        var minLength = Array.isArray(item.length) && item.length[0] || item.length || 1;\n        var maxLength = Array.isArray(item.length) && item.length[1] || item.length || value.length - valueIndex;\n        var _length = maxLength;\n\n        while (!found && _length >= minLength) {\n          var _part = value.slice(valueIndex, valueIndex + _length);\n\n          if (item.regexp.test(_part)) {\n            valueParts.push({\n              part: _part,\n              beginIndex: valueIndex,\n              endIndex: valueIndex + _length - 1\n            });\n            valueIndex += _length;\n            maskIndex += 1;\n            found = true;\n          }\n\n          _length -= 1;\n        }\n\n        if (!found) {\n          valueIndex = value.length;\n        }\n      } else {\n        var _length2 = Array.isArray(item.length) ? item.length[1] : item.length || value.length - valueIndex;\n\n        var _part2 = value.slice(valueIndex, valueIndex + _length2);\n\n        valueParts.push({\n          part: _part2,\n          beginIndex: valueIndex,\n          endIndex: valueIndex + _length2 - 1\n        });\n        valueIndex += _length2;\n        maskIndex += 1;\n      }\n    }\n  }\n\n  return valueParts;\n};\n\nvar defaultMask = [{\n  regexp: /[^]*/\n}];\nvar dropAlign = {\n  top: 'bottom',\n  left: 'left'\n};\nvar MaskedInput = /*#__PURE__*/forwardRef(function (_ref, ref) {\n  var a11yTitle = _ref.a11yTitle,\n      focusProp = _ref.focus,\n      icon = _ref.icon,\n      id = _ref.id,\n      _ref$mask = _ref.mask,\n      mask = _ref$mask === void 0 ? defaultMask : _ref$mask,\n      name = _ref.name,\n      _onBlur = _ref.onBlur,\n      onChange = _ref.onChange,\n      _onFocus = _ref.onFocus,\n      onKeyDown = _ref.onKeyDown,\n      placeholder = _ref.placeholder,\n      plain = _ref.plain,\n      reverse = _ref.reverse,\n      valueProp = _ref.value,\n      rest = _objectWithoutPropertiesLoose(_ref, [\"a11yTitle\", \"focus\", \"icon\", \"id\", \"mask\", \"name\", \"onBlur\", \"onChange\", \"onFocus\", \"onKeyDown\", \"placeholder\", \"plain\", \"reverse\", \"value\"]);\n\n  var theme = useContext(ThemeContext) || defaultProps.theme;\n  var formContext = useContext(FormContext);\n\n  var _formContext$useFormI = formContext.useFormInput(name, valueProp),\n      value = _formContext$useFormI[0],\n      setValue = _formContext$useFormI[1];\n\n  var _useState = useState(parseValue(mask, value)),\n      valueParts = _useState[0],\n      setValueParts = _useState[1];\n\n  useEffect(function () {\n    setValueParts(parseValue(mask, value));\n  }, [mask, value]);\n  var inputRef = useForwardedRef(ref);\n  var dropRef = useRef();\n\n  var _useState2 = useState(focusProp),\n      focus = _useState2[0],\n      setFocus = _useState2[1];\n\n  var _useState3 = useState(),\n      activeMaskIndex = _useState3[0],\n      setActiveMaskIndex = _useState3[1];\n\n  var _useState4 = useState(),\n      activeOptionIndex = _useState4[0],\n      setActiveOptionIndex = _useState4[1];\n\n  var _useState5 = useState(),\n      showDrop = _useState5[0],\n      setShowDrop = _useState5[1];\n\n  useEffect(function () {\n    if (focus) {\n      var timer = setTimeout(function () {\n        // determine which mask element the caret is at\n        var caretIndex = inputRef.current.selectionStart;\n        var maskIndex;\n        valueParts.some(function (part, index) {\n          if (part.beginIndex <= caretIndex && part.endIndex >= caretIndex) {\n            maskIndex = index;\n            return true;\n          }\n\n          return false;\n        });\n\n        if (maskIndex === undefined && valueParts.length < mask.length) {\n          maskIndex = valueParts.length; // first unused one\n        }\n\n        if (maskIndex && mask[maskIndex].fixed) {\n          maskIndex -= 1; // fixed mask parts are never \"active\"\n        }\n\n        if (maskIndex !== activeMaskIndex) {\n          setActiveMaskIndex(maskIndex);\n          setActiveOptionIndex(-1);\n          setShowDrop(maskIndex >= 0 && mask[maskIndex].options && true);\n        }\n      }, 10); // 10ms empirically chosen\n\n      return function () {\n        return clearTimeout(timer);\n      };\n    }\n\n    return undefined;\n  }, [activeMaskIndex, focus, inputRef, mask, valueParts]);\n  var setInputValue = useCallback(function (nextValue) {\n    // Calling set value function directly on input because React library\n    // overrides setter `event.target.value =` and loses original event\n    // target fidelity.\n    // https://stackoverflow.com/a/46012210 &&\n    // https://github.com/grommet/grommet/pull/3171#discussion_r296415239\n    var nativeInputValueSetter = Object.getOwnPropertyDescriptor(window.HTMLInputElement.prototype, 'value').set;\n    nativeInputValueSetter.call(inputRef.current, nextValue);\n    var event = new Event('input', {\n      bubbles: true\n    });\n    inputRef.current.dispatchEvent(event);\n  }, [inputRef]); // This could be due to a paste or as the user is typing.\n\n  var onChangeInput = useCallback(function (event) {\n    // Align with the mask.\n    var nextValueParts = parseValue(mask, event.target.value);\n    var nextValue = nextValueParts.map(function (part) {\n      return part.part;\n    }).join('');\n\n    if (nextValue !== event.target.value) {\n      // The mask required inserting something, change the input.\n      // This will re-trigger this callback with the next value\n      setInputValue(nextValue);\n    } else if (value !== nextValue) {\n      setValue(nextValue);\n      if (onChange) onChange(event);\n    }\n  }, [mask, onChange, setInputValue, setValue, value]);\n  var onOption = useCallback(function (option) {\n    return function () {\n      var nextValueParts = [].concat(valueParts);\n      nextValueParts[activeMaskIndex] = {\n        part: option\n      }; // add any fixed parts that follow\n\n      var index = activeMaskIndex + 1;\n\n      while (index < mask.length && !nextValueParts[index] && mask[index].fixed) {\n        nextValueParts[index] = {\n          part: mask[index].fixed\n        };\n        index += 1;\n      }\n\n      var nextValue = nextValueParts.map(function (part) {\n        return part.part;\n      }).join('');\n      setInputValue(nextValue); // restore focus to input\n\n      inputRef.current.focus();\n    };\n  }, [activeMaskIndex, inputRef, mask, setInputValue, valueParts]);\n  var onNextOption = useCallback(function (event) {\n    var item = mask[activeMaskIndex];\n\n    if (item && item.options) {\n      event.preventDefault();\n      var index = Math.min(activeOptionIndex + 1, item.options.length - 1);\n      setActiveOptionIndex(index);\n    }\n  }, [activeMaskIndex, activeOptionIndex, mask]);\n  var onPreviousOption = useCallback(function (event) {\n    if (activeMaskIndex >= 0 && mask[activeMaskIndex].options) {\n      event.preventDefault();\n      var index = Math.max(activeOptionIndex - 1, 0);\n      setActiveOptionIndex(index);\n    }\n  }, [activeMaskIndex, activeOptionIndex, mask]);\n  var onSelectOption = useCallback(function (event) {\n    if (activeMaskIndex >= 0 && activeOptionIndex >= 0) {\n      event.preventDefault();\n      var option = mask[activeMaskIndex].options[activeOptionIndex];\n      onOption(option)();\n    }\n  }, [activeMaskIndex, activeOptionIndex, mask, onOption]);\n  var onEsc = useCallback(function (event) {\n    if (showDrop) {\n      // we have to stop both synthetic events and native events\n      // drop and layer should not close by pressing esc on this input\n      event.stopPropagation();\n      event.nativeEvent.stopImmediatePropagation();\n      setShowDrop(false);\n    }\n  }, [showDrop]);\n  var onHideDrop = useCallback(function () {\n    return setShowDrop(false);\n  }, []);\n\n  var renderPlaceholder = function renderPlaceholder() {\n    return mask.map(function (item) {\n      return item.placeholder || item.fixed;\n    }).join('');\n  };\n\n  return /*#__PURE__*/React.createElement(StyledMaskedInputContainer, {\n    plain: plain\n  }, icon && /*#__PURE__*/React.createElement(StyledIcon, {\n    reverse: reverse,\n    theme: theme\n  }, icon), /*#__PURE__*/React.createElement(Keyboard, {\n    onEsc: onEsc,\n    onTab: showDrop ? function () {\n      return setShowDrop(false);\n    } : undefined,\n    onLeft: undefined,\n    onRight: undefined,\n    onUp: onPreviousOption,\n    onDown: showDrop ? onNextOption : function () {\n      return setShowDrop(true);\n    },\n    onEnter: onSelectOption,\n    onKeyDown: onKeyDown\n  }, /*#__PURE__*/React.createElement(StyledMaskedInput, _extends({\n    ref: inputRef,\n    \"aria-label\": a11yTitle,\n    id: id,\n    name: name,\n    autoComplete: \"off\",\n    plain: plain,\n    placeholder: placeholder || renderPlaceholder(),\n    icon: icon,\n    reverse: reverse,\n    focus: focus\n  }, rest, {\n    value: value,\n    theme: theme,\n    onFocus: function onFocus(event) {\n      setFocus(true);\n      setShowDrop(true);\n      if (_onFocus) _onFocus(event);\n    },\n    onBlur: function onBlur(event) {\n      setFocus(false); // This will be called when the user clicks on a suggestion,\n      // check for that and don't remove the drop in that case.\n      // Drop will already have removed itself if the user has focused\n      // outside of the Drop.\n\n      if (!dropRef.current) setShowDrop(false);\n      if (_onBlur) _onBlur(event);\n    },\n    onChange: onChangeInput\n  }))), showDrop && mask[activeMaskIndex] && mask[activeMaskIndex].options && /*#__PURE__*/React.createElement(Drop, {\n    id: id ? \"masked-input-drop__\" + id : undefined,\n    align: dropAlign,\n    responsive: false,\n    target: inputRef.current,\n    onClickOutside: onHideDrop,\n    onEsc: onHideDrop\n  }, /*#__PURE__*/React.createElement(Box, {\n    ref: dropRef\n  }, mask[activeMaskIndex].options.map(function (option, index) {\n    // Determine whether the label is done as a child or\n    // as an option Button kind property.\n    var child = !theme.button.option ? /*#__PURE__*/React.createElement(Box, {\n      pad: {\n        horizontal: 'small',\n        vertical: 'xsmall'\n      }\n    }, option) : undefined; // if we have a child, turn on plain, and hoverIndicator\n\n    return /*#__PURE__*/React.createElement(Box, {\n      key: option,\n      flex: false\n    }, /*#__PURE__*/React.createElement(Button, {\n      tabIndex: \"-1\",\n      onClick: onOption(option),\n      onMouseOver: function onMouseOver() {\n        return setActiveOptionIndex(index);\n      },\n      onFocus: function onFocus() {},\n      active: index === activeOptionIndex,\n      plain: !child ? undefined : true,\n      align: \"start\",\n      kind: !child ? 'option' : undefined,\n      hoverIndicator: !child ? undefined : 'background',\n      label: !child ? option : undefined\n    }, child));\n  }))));\n});\nMaskedInput.displayName = 'MaskedInput';\nvar MaskedInputDoc;\n\nif (process.env.NODE_ENV !== 'production') {\n  // eslint-disable-next-line global-require\n  MaskedInputDoc = require('./doc').doc(MaskedInput);\n}\n\nvar MaskedInputWrapper = MaskedInputDoc || MaskedInput;\nexport { MaskedInputWrapper as MaskedInput };","map":{"version":3,"sources":["/Users/erwanbeguin/Documents/Developper/ynov/dataviz/node_modules/grommet/es6/components/MaskedInput/MaskedInput.js"],"names":["_extends","Object","assign","target","i","arguments","length","source","key","prototype","hasOwnProperty","call","apply","_objectWithoutPropertiesLoose","excluded","sourceKeys","keys","indexOf","React","forwardRef","useCallback","useContext","useEffect","useRef","useState","ThemeContext","defaultProps","Box","Button","Drop","FormContext","Keyboard","useForwardedRef","StyledMaskedInput","StyledMaskedInputContainer","StyledIcon","parseValue","mask","value","valueParts","valueIndex","maskIndex","undefined","item","found","fixed","matching","part","slice","push","beginIndex","endIndex","options","reverse","some","option","regexp","minLength","Array","isArray","maxLength","_length","_part","test","_length2","_part2","defaultMask","dropAlign","top","left","MaskedInput","_ref","ref","a11yTitle","focusProp","focus","icon","id","_ref$mask","name","_onBlur","onBlur","onChange","_onFocus","onFocus","onKeyDown","placeholder","plain","valueProp","rest","theme","formContext","_formContext$useFormI","useFormInput","setValue","_useState","setValueParts","inputRef","dropRef","_useState2","setFocus","_useState3","activeMaskIndex","setActiveMaskIndex","_useState4","activeOptionIndex","setActiveOptionIndex","_useState5","showDrop","setShowDrop","timer","setTimeout","caretIndex","current","selectionStart","index","clearTimeout","setInputValue","nextValue","nativeInputValueSetter","getOwnPropertyDescriptor","window","HTMLInputElement","set","event","Event","bubbles","dispatchEvent","onChangeInput","nextValueParts","map","join","onOption","concat","onNextOption","preventDefault","Math","min","onPreviousOption","max","onSelectOption","onEsc","stopPropagation","nativeEvent","stopImmediatePropagation","onHideDrop","renderPlaceholder","createElement","onTab","onLeft","onRight","onUp","onDown","onEnter","autoComplete","align","responsive","onClickOutside","child","button","pad","horizontal","vertical","flex","tabIndex","onClick","onMouseOver","active","kind","hoverIndicator","label","displayName","MaskedInputDoc","process","env","NODE_ENV","require","doc","MaskedInputWrapper"],"mappings":"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","sourcesContent":["function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\nimport React, { forwardRef, useCallback, useContext, useEffect, useRef, useState } from 'react';\nimport { ThemeContext } from 'styled-components';\nimport { defaultProps } from '../../default-props';\nimport { Box } from '../Box';\nimport { Button } from '../Button';\nimport { Drop } from '../Drop';\nimport { FormContext } from '../Form/FormContext';\nimport { Keyboard } from '../Keyboard';\nimport { useForwardedRef } from '../../utils';\nimport { StyledMaskedInput, StyledMaskedInputContainer, StyledIcon } from './StyledMaskedInput';\n\nvar parseValue = function parseValue(mask, value) {\n  // break the value up into mask parts\n  var valueParts = []; // { part, beginIndex, endIndex }\n\n  var valueIndex = 0;\n  var maskIndex = 0;\n\n  while (value !== undefined && valueIndex < value.length && maskIndex < mask.length) {\n    var item = mask[maskIndex];\n    var found = void 0;\n\n    if (item.fixed) {\n      var length = item.fixed.length; // grab however much of value (starting at valueIndex) matches\n      // item.fixed. If none matches it and there is more in value\n      // add in the fixed item.\n\n      var matching = 0;\n\n      while (matching < length && value[valueIndex + matching] === item.fixed[matching]) {\n        matching += 1;\n      }\n\n      if (matching > 0) {\n        var part = value.slice(valueIndex, valueIndex + matching);\n\n        if (valueIndex + matching < value.length) {\n          // matched part of the fixed portion but there's more stuff\n          // after it. Go ahead and fill in the entire fixed chunk\n          part = item.fixed;\n        }\n\n        valueParts.push({\n          part: part,\n          beginIndex: valueIndex,\n          endIndex: valueIndex + matching - 1\n        });\n        valueIndex += matching;\n      } else {\n        valueParts.push({\n          part: item.fixed,\n          beginIndex: valueIndex,\n          endIndex: valueIndex + length - 1\n        });\n      }\n\n      maskIndex += 1;\n      found = true;\n    } else if (item.options) {\n      // reverse assuming larger is later\n      found = item.options.slice(0).reverse() // eslint-disable-next-line no-loop-func\n      .some(function (option) {\n        var length = option.length;\n        var part = value.slice(valueIndex, valueIndex + length);\n\n        if (part === option) {\n          valueParts.push({\n            part: part,\n            beginIndex: valueIndex,\n            endIndex: valueIndex + length - 1\n          });\n          valueIndex += length;\n          maskIndex += 1;\n          return true;\n        }\n\n        return false;\n      });\n    }\n\n    if (!found) {\n      if (item.regexp) {\n        var minLength = Array.isArray(item.length) && item.length[0] || item.length || 1;\n        var maxLength = Array.isArray(item.length) && item.length[1] || item.length || value.length - valueIndex;\n        var _length = maxLength;\n\n        while (!found && _length >= minLength) {\n          var _part = value.slice(valueIndex, valueIndex + _length);\n\n          if (item.regexp.test(_part)) {\n            valueParts.push({\n              part: _part,\n              beginIndex: valueIndex,\n              endIndex: valueIndex + _length - 1\n            });\n            valueIndex += _length;\n            maskIndex += 1;\n            found = true;\n          }\n\n          _length -= 1;\n        }\n\n        if (!found) {\n          valueIndex = value.length;\n        }\n      } else {\n        var _length2 = Array.isArray(item.length) ? item.length[1] : item.length || value.length - valueIndex;\n\n        var _part2 = value.slice(valueIndex, valueIndex + _length2);\n\n        valueParts.push({\n          part: _part2,\n          beginIndex: valueIndex,\n          endIndex: valueIndex + _length2 - 1\n        });\n        valueIndex += _length2;\n        maskIndex += 1;\n      }\n    }\n  }\n\n  return valueParts;\n};\n\nvar defaultMask = [{\n  regexp: /[^]*/\n}];\nvar dropAlign = {\n  top: 'bottom',\n  left: 'left'\n};\nvar MaskedInput = /*#__PURE__*/forwardRef(function (_ref, ref) {\n  var a11yTitle = _ref.a11yTitle,\n      focusProp = _ref.focus,\n      icon = _ref.icon,\n      id = _ref.id,\n      _ref$mask = _ref.mask,\n      mask = _ref$mask === void 0 ? defaultMask : _ref$mask,\n      name = _ref.name,\n      _onBlur = _ref.onBlur,\n      onChange = _ref.onChange,\n      _onFocus = _ref.onFocus,\n      onKeyDown = _ref.onKeyDown,\n      placeholder = _ref.placeholder,\n      plain = _ref.plain,\n      reverse = _ref.reverse,\n      valueProp = _ref.value,\n      rest = _objectWithoutPropertiesLoose(_ref, [\"a11yTitle\", \"focus\", \"icon\", \"id\", \"mask\", \"name\", \"onBlur\", \"onChange\", \"onFocus\", \"onKeyDown\", \"placeholder\", \"plain\", \"reverse\", \"value\"]);\n\n  var theme = useContext(ThemeContext) || defaultProps.theme;\n  var formContext = useContext(FormContext);\n\n  var _formContext$useFormI = formContext.useFormInput(name, valueProp),\n      value = _formContext$useFormI[0],\n      setValue = _formContext$useFormI[1];\n\n  var _useState = useState(parseValue(mask, value)),\n      valueParts = _useState[0],\n      setValueParts = _useState[1];\n\n  useEffect(function () {\n    setValueParts(parseValue(mask, value));\n  }, [mask, value]);\n  var inputRef = useForwardedRef(ref);\n  var dropRef = useRef();\n\n  var _useState2 = useState(focusProp),\n      focus = _useState2[0],\n      setFocus = _useState2[1];\n\n  var _useState3 = useState(),\n      activeMaskIndex = _useState3[0],\n      setActiveMaskIndex = _useState3[1];\n\n  var _useState4 = useState(),\n      activeOptionIndex = _useState4[0],\n      setActiveOptionIndex = _useState4[1];\n\n  var _useState5 = useState(),\n      showDrop = _useState5[0],\n      setShowDrop = _useState5[1];\n\n  useEffect(function () {\n    if (focus) {\n      var timer = setTimeout(function () {\n        // determine which mask element the caret is at\n        var caretIndex = inputRef.current.selectionStart;\n        var maskIndex;\n        valueParts.some(function (part, index) {\n          if (part.beginIndex <= caretIndex && part.endIndex >= caretIndex) {\n            maskIndex = index;\n            return true;\n          }\n\n          return false;\n        });\n\n        if (maskIndex === undefined && valueParts.length < mask.length) {\n          maskIndex = valueParts.length; // first unused one\n        }\n\n        if (maskIndex && mask[maskIndex].fixed) {\n          maskIndex -= 1; // fixed mask parts are never \"active\"\n        }\n\n        if (maskIndex !== activeMaskIndex) {\n          setActiveMaskIndex(maskIndex);\n          setActiveOptionIndex(-1);\n          setShowDrop(maskIndex >= 0 && mask[maskIndex].options && true);\n        }\n      }, 10); // 10ms empirically chosen\n\n      return function () {\n        return clearTimeout(timer);\n      };\n    }\n\n    return undefined;\n  }, [activeMaskIndex, focus, inputRef, mask, valueParts]);\n  var setInputValue = useCallback(function (nextValue) {\n    // Calling set value function directly on input because React library\n    // overrides setter `event.target.value =` and loses original event\n    // target fidelity.\n    // https://stackoverflow.com/a/46012210 &&\n    // https://github.com/grommet/grommet/pull/3171#discussion_r296415239\n    var nativeInputValueSetter = Object.getOwnPropertyDescriptor(window.HTMLInputElement.prototype, 'value').set;\n    nativeInputValueSetter.call(inputRef.current, nextValue);\n    var event = new Event('input', {\n      bubbles: true\n    });\n    inputRef.current.dispatchEvent(event);\n  }, [inputRef]); // This could be due to a paste or as the user is typing.\n\n  var onChangeInput = useCallback(function (event) {\n    // Align with the mask.\n    var nextValueParts = parseValue(mask, event.target.value);\n    var nextValue = nextValueParts.map(function (part) {\n      return part.part;\n    }).join('');\n\n    if (nextValue !== event.target.value) {\n      // The mask required inserting something, change the input.\n      // This will re-trigger this callback with the next value\n      setInputValue(nextValue);\n    } else if (value !== nextValue) {\n      setValue(nextValue);\n      if (onChange) onChange(event);\n    }\n  }, [mask, onChange, setInputValue, setValue, value]);\n  var onOption = useCallback(function (option) {\n    return function () {\n      var nextValueParts = [].concat(valueParts);\n      nextValueParts[activeMaskIndex] = {\n        part: option\n      }; // add any fixed parts that follow\n\n      var index = activeMaskIndex + 1;\n\n      while (index < mask.length && !nextValueParts[index] && mask[index].fixed) {\n        nextValueParts[index] = {\n          part: mask[index].fixed\n        };\n        index += 1;\n      }\n\n      var nextValue = nextValueParts.map(function (part) {\n        return part.part;\n      }).join('');\n      setInputValue(nextValue); // restore focus to input\n\n      inputRef.current.focus();\n    };\n  }, [activeMaskIndex, inputRef, mask, setInputValue, valueParts]);\n  var onNextOption = useCallback(function (event) {\n    var item = mask[activeMaskIndex];\n\n    if (item && item.options) {\n      event.preventDefault();\n      var index = Math.min(activeOptionIndex + 1, item.options.length - 1);\n      setActiveOptionIndex(index);\n    }\n  }, [activeMaskIndex, activeOptionIndex, mask]);\n  var onPreviousOption = useCallback(function (event) {\n    if (activeMaskIndex >= 0 && mask[activeMaskIndex].options) {\n      event.preventDefault();\n      var index = Math.max(activeOptionIndex - 1, 0);\n      setActiveOptionIndex(index);\n    }\n  }, [activeMaskIndex, activeOptionIndex, mask]);\n  var onSelectOption = useCallback(function (event) {\n    if (activeMaskIndex >= 0 && activeOptionIndex >= 0) {\n      event.preventDefault();\n      var option = mask[activeMaskIndex].options[activeOptionIndex];\n      onOption(option)();\n    }\n  }, [activeMaskIndex, activeOptionIndex, mask, onOption]);\n  var onEsc = useCallback(function (event) {\n    if (showDrop) {\n      // we have to stop both synthetic events and native events\n      // drop and layer should not close by pressing esc on this input\n      event.stopPropagation();\n      event.nativeEvent.stopImmediatePropagation();\n      setShowDrop(false);\n    }\n  }, [showDrop]);\n  var onHideDrop = useCallback(function () {\n    return setShowDrop(false);\n  }, []);\n\n  var renderPlaceholder = function renderPlaceholder() {\n    return mask.map(function (item) {\n      return item.placeholder || item.fixed;\n    }).join('');\n  };\n\n  return /*#__PURE__*/React.createElement(StyledMaskedInputContainer, {\n    plain: plain\n  }, icon && /*#__PURE__*/React.createElement(StyledIcon, {\n    reverse: reverse,\n    theme: theme\n  }, icon), /*#__PURE__*/React.createElement(Keyboard, {\n    onEsc: onEsc,\n    onTab: showDrop ? function () {\n      return setShowDrop(false);\n    } : undefined,\n    onLeft: undefined,\n    onRight: undefined,\n    onUp: onPreviousOption,\n    onDown: showDrop ? onNextOption : function () {\n      return setShowDrop(true);\n    },\n    onEnter: onSelectOption,\n    onKeyDown: onKeyDown\n  }, /*#__PURE__*/React.createElement(StyledMaskedInput, _extends({\n    ref: inputRef,\n    \"aria-label\": a11yTitle,\n    id: id,\n    name: name,\n    autoComplete: \"off\",\n    plain: plain,\n    placeholder: placeholder || renderPlaceholder(),\n    icon: icon,\n    reverse: reverse,\n    focus: focus\n  }, rest, {\n    value: value,\n    theme: theme,\n    onFocus: function onFocus(event) {\n      setFocus(true);\n      setShowDrop(true);\n      if (_onFocus) _onFocus(event);\n    },\n    onBlur: function onBlur(event) {\n      setFocus(false); // This will be called when the user clicks on a suggestion,\n      // check for that and don't remove the drop in that case.\n      // Drop will already have removed itself if the user has focused\n      // outside of the Drop.\n\n      if (!dropRef.current) setShowDrop(false);\n      if (_onBlur) _onBlur(event);\n    },\n    onChange: onChangeInput\n  }))), showDrop && mask[activeMaskIndex] && mask[activeMaskIndex].options && /*#__PURE__*/React.createElement(Drop, {\n    id: id ? \"masked-input-drop__\" + id : undefined,\n    align: dropAlign,\n    responsive: false,\n    target: inputRef.current,\n    onClickOutside: onHideDrop,\n    onEsc: onHideDrop\n  }, /*#__PURE__*/React.createElement(Box, {\n    ref: dropRef\n  }, mask[activeMaskIndex].options.map(function (option, index) {\n    // Determine whether the label is done as a child or\n    // as an option Button kind property.\n    var child = !theme.button.option ? /*#__PURE__*/React.createElement(Box, {\n      pad: {\n        horizontal: 'small',\n        vertical: 'xsmall'\n      }\n    }, option) : undefined; // if we have a child, turn on plain, and hoverIndicator\n\n    return /*#__PURE__*/React.createElement(Box, {\n      key: option,\n      flex: false\n    }, /*#__PURE__*/React.createElement(Button, {\n      tabIndex: \"-1\",\n      onClick: onOption(option),\n      onMouseOver: function onMouseOver() {\n        return setActiveOptionIndex(index);\n      },\n      onFocus: function onFocus() {},\n      active: index === activeOptionIndex,\n      plain: !child ? undefined : true,\n      align: \"start\",\n      kind: !child ? 'option' : undefined,\n      hoverIndicator: !child ? undefined : 'background',\n      label: !child ? option : undefined\n    }, child));\n  }))));\n});\nMaskedInput.displayName = 'MaskedInput';\nvar MaskedInputDoc;\n\nif (process.env.NODE_ENV !== 'production') {\n  // eslint-disable-next-line global-require\n  MaskedInputDoc = require('./doc').doc(MaskedInput);\n}\n\nvar MaskedInputWrapper = MaskedInputDoc || MaskedInput;\nexport { MaskedInputWrapper as MaskedInput };"]},"metadata":{},"sourceType":"module"}